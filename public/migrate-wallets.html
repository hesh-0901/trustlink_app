<!DOCTYPE html>
<html>
<head>
  <title>Migration Wallets</title>
</head>
<body>

<h2>Migration wallets...</h2>

<script type="module">

import { db } from "./js/firebase-init.js";
import {
  collection,
  getDocs,
  updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

async function migrateWallets() {

  const snapshot = await getDocs(collection(db, "wallets"));

  for (const docSnap of snapshot.docs) {
    const data = docSnap.data();

    if (data.reservedBalance === undefined) {
      await updateDoc(docSnap.ref, {
        reservedBalance: 0
      });
    }
  }

  console.log("Migration terminée ✔️");
  alert("Migration terminée ✔️");
}

migrateWallets();

</script>

</body>
</html>
